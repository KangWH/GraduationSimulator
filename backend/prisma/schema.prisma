generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  password String
  profile  Profile?
}

model Profile {
  id                        String       @id @default(uuid())
  userId                    String       @unique
  name                      String
  studentId                 String       @unique
  admissionYear             Int
  isFallAdmission           Boolean
  major                     String
  doubleMajors              String[]
  minors                    String[]
  advancedMajor             Boolean      @default(false)
  individuallyDesignedMajor Boolean      @default(false)
  enrollments               Json
  user                      User         @relation(fields: [userId], references: [id])
  simulations               Simulation[] @relation("ProfileToSimulation")
}

model Simulation {
  id                        String   @id @default(uuid())
  profileId                 String
  title                     String
  updatedAt                 DateTime
  referenceYear             Int
  major                     String
  doubleMajors              String[]
  minors                    String[]
  advancedMajor             Boolean
  individuallyDesignedMajor Boolean
  courses                   Json
  earlyGraduation           Boolean  @default(false)
  profile                   Profile  @relation("ProfileToSimulation", fields: [profileId], references: [id])
}

model CourseOffering {
  id               String   @id @default(uuid())
  code             String
  title            String
  department       String
  category         String
  tags             String[]
  credit           Int
  au               Int
  crossRecognition Boolean
  level            String
  searchTitle      String

  @@unique([code, title, category, tags, credit, au])
  @@index([code, searchTitle])
}

model GeneralEdRequirement {
  id           String @id @default(uuid())
  year         Int
  type         String
  requirements Json

  @@unique([year, type])
  @@index([year, type])
}

model MajorRequirement {
  id           String @id @default(uuid())
  year         Int
  department   String
  type         String
  requirements Json

  @@unique([year, department, type])
  @@index([year, department, type])
}

model CourseSubstitution {
  id                   String  @id @default(uuid())
  originalCourseCode   String
  substituteCourseCode String
  department           String?
  startYear            Int
  endYear              Int?
  description          String?

  @@unique([originalCourseCode, substituteCourseCode, department, startYear])
  @@index([originalCourseCode])
  @@index([substituteCourseCode])
  @@index([department, startYear])
}
